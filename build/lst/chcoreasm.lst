ARM GAS  /tmp/cclqlCXs.s 			page 1


   1              	# 1 ".//os/common/ports/ARMv8-M-ML/compilers/GCC/chcoreasm.S"
   1              	/*
   1              	...
   0              	
   0              	
   2              	    ChibiOS - Copyright (C) 2006,2007,2008,2009,2010,2011,2012,2013,2014,
   3              	              2015,2016,2017,2018,2019,2020,2021 Giovanni Di Sirio.
   4              	
   5              	    This file is part of ChibiOS.
   6              	
   7              	    ChibiOS is free software; you can redistribute it and/or modify
   8              	    it under the terms of the GNU General Public License as published by
   9              	    the Free Software Foundation version 3 of the License.
  10              	
  11              	    ChibiOS is distributed in the hope that it will be useful,
  12              	    but WITHOUT ANY WARRANTY; without even the implied warranty of
  13              	    MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE.  See the
  14              	    GNU General Public License for more details.
  15              	
  16              	    You should have received a copy of the GNU General Public License
  17              	    along with this program.  If not, see <http://www.gnu.org/licenses/>.
  18              	*/
  19              	
  20              	/**
  21              	 * @file    ARMv8-M-ML/compilers/GCC/chcoreasm.S
  22              	 * @brief   ARMv8-M MainLine port low level code.
  23              	 *
  24              	 * @addtogroup ARMV8M_ML_GCC_CORE
  25              	 * @{
  26              	 */
  27              	
  28              	#if !defined(FALSE) || defined(__DOXYGEN__)
  29              	#define FALSE   0
  30              	#endif
  31              	
  32              	#if !defined(TRUE) || defined(__DOXYGEN__)
  33              	#define TRUE    1
  34              	#endif
  35              	
  36              	#define _FROM_ASM_
  37              	#include "chlicense.h"
   1              	/*
   2              	    ChibiOS - Copyright (C) 2006,2007,2008,2009,2010,2011,2012,2013,2014,
   3              	              2015,2016,2017,2018,2019,2020,2021 Giovanni Di Sirio.
   4              	
   5              	    This file is part of ChibiOS.
   6              	
   7              	    ChibiOS is free software; you can redistribute it and/or modify
   8              	    it under the terms of the GNU General Public License as published by
   9              	    the Free Software Foundation version 3 of the License.
  10              	
  11              	    ChibiOS is distributed in the hope that it will be useful,
  12              	    but WITHOUT ANY WARRANTY; without even the implied warranty of
  13              	    MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE.  See the
  14              	    GNU General Public License for more details.
  15              	
  16              	    You should have received a copy of the GNU General Public License
ARM GAS  /tmp/cclqlCXs.s 			page 2


  17              	    along with this program.  If not, see <http://www.gnu.org/licenses/>.
  18              	*/
  19              	
  20              	/**
  21              	 * @file    chlicense.h
  22              	 * @brief   License Module macros and structures.
  23              	 *
  24              	 * @addtogroup chibios_license
  25              	 * @details This module contains all the definitions required for defining
  26              	 *          a licensing scheme for customers or public releases.
  27              	 * @{
  28              	 */
  29              	
  30              	#ifndef CHLICENSE_H
  31              	#define CHLICENSE_H
  32              	
  33              	/*===========================================================================*/
  34              	/* Module constants.                                                         */
  35              	/*===========================================================================*/
  36              	
  37              	/**
  38              	 * @name   Allowed Features Levels
  39              	 * @{
  40              	 */
  41              	#define CH_FEATURES_BASIC                   0
  42              	#define CH_FEATURES_INTERMEDIATE            1
  43              	#define CH_FEATURES_FULL                    2
  44              	/** @} */
  45              	
  46              	/**
  47              	 * @name    Deployment Options
  48              	 * @{
  49              	 */
  50              	#define CH_DEPLOY_UNLIMITED                -1
  51              	#define CH_DEPLOY_NONE                      0
  52              	/** @} */
  53              	
  54              	/**
  55              	 * @name    Licensing Options
  56              	 * @{
  57              	 */
  58              	#define CH_LICENSE_GPL                      0
  59              	#define CH_LICENSE_GPL_EXCEPTION            1
  60              	#define CH_LICENSE_COMMERCIAL_FREE          2
  61              	#define CH_LICENSE_COMMERCIAL_DEV_1000      3
  62              	#define CH_LICENSE_COMMERCIAL_DEV_5000      4
  63              	#define CH_LICENSE_COMMERCIAL_FULL          5
  64              	#define CH_LICENSE_COMMERCIAL_RUNTIME       6
  65              	#define CH_LICENSE_PARTNER                  7
  66              	/** @} */
  67              	
  68              	#include "chversion.h"
   1              	/*
  69              	#include "chcustomer.h"
   1              	/*
  70              	#if CH_LICENSE == CH_LICENSE_PARTNER
  38              	#include "chconf.h"
ARM GAS  /tmp/cclqlCXs.s 			page 3


   1              	/*
  39              	#include "chcore.h"
   1              	/*
   2              	    ChibiOS - Copyright (C) 2006,2007,2008,2009,2010,2011,2012,2013,2014,
   3              	              2015,2016,2017,2018,2019,2020,2021 Giovanni Di Sirio.
   4              	
   5              	    This file is part of ChibiOS.
   6              	
   7              	    ChibiOS is free software; you can redistribute it and/or modify
   8              	    it under the terms of the GNU General Public License as published by
   9              	    the Free Software Foundation version 3 of the License.
  10              	
  11              	    ChibiOS is distributed in the hope that it will be useful,
  12              	    but WITHOUT ANY WARRANTY; without even the implied warranty of
  13              	    MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE.  See the
  14              	    GNU General Public License for more details.
  15              	
  16              	    You should have received a copy of the GNU General Public License
  17              	    along with this program.  If not, see <http://www.gnu.org/licenses/>.
  18              	*/
  19              	
  20              	/**
  21              	 * @file    ARMv8-M-ML/chcore.h
  22              	 * @brief   ARMv8-M MainLine port macros and structures.
  23              	 *
  24              	 * @addtogroup ARMV8M_ML_CORE
  25              	 * @{
  26              	 */
  27              	
  28              	#ifndef CHCORE_H
  29              	#define CHCORE_H
  30              	
  31              	/* Inclusion of the Cortex-Mx implementation specific parameters.*/
  32              	#include "cmparams.h"
   1              	/*
  33              	
  40              	
  41              	#if !defined(__DOXYGEN__)
  42              	
  43              	/*
  44              	 * RTOS-specific context offset.
  45              	 */
  46              	#if defined(_CHIBIOS_RT_CONF_)
  47              	#define CONTEXT_OFFSET  12
  48              	
  49              	#elif defined(_CHIBIOS_NIL_CONF_)
  50              	#define CONTEXT_OFFSET  0
  51              	
  52              	#else
  53              	#error "invalid chconf.h"
  54              	#endif
  55              	
  56              	/* MPU-related constants.*/
  57              	#define MPU_RBAR        0xE000ED9C
  58              	
  59              	/* Other constants.*/
  60              	#define SCB_ICSR        0xE000ED04
ARM GAS  /tmp/cclqlCXs.s 			page 4


  61              	#define ICSR_PENDSVSET  0x10000000
  62              	
  63              	                .syntax unified
  64              	                .cpu    cortex-m4
  65              	#if CORTEX_USE_FPU
  66              	                .fpu    fpv4-sp-d16
  67              	#else
  68              	                .fpu    softvfp
  69              	#endif
  70              	
  71              	                .thumb
  72              	                .text
  73              	
  74              	/*--------------------------------------------------------------------------*
  75              	 * Performs a context switch between two threads.
  76              	 *--------------------------------------------------------------------------*/
  77              	                .thumb_func
  78              	                .globl  __port_switch
  79              	__port_switch:
  80 0000 2DE9F04F 	                push    {r4, r5, r6, r7, r8, r9, r10, r11, lr}
  81              	#if CORTEX_USE_FPU
  82              	                /* Saving FPU context.*/
  83              	                vpush   {s16-s31}
  84              	#endif
  85              	
  86              	#if CH_DBG_ENABLE_STACK_CHECK
  87              	                /* Saving stack limit register.*/
  88              	                mrs     r3, PSPLIM
  89              	                push    {r3}
  90              	                movs    r3, #0
  91              	                msr     PSPLIM, r3      /* Temporarily disabling stack check.*/
  92              	#endif
  93              	
  94              	                /* Switching stacks.*/
  95 0004 C1F80CD0 	                str     sp, [r1, #CONTEXT_OFFSET]
  96 0008 D0F80CD0 	                ldr     sp, [r0, #CONTEXT_OFFSET]
  97              	
  98              	#if CH_DBG_ENABLE_STACK_CHECK
  99              	                pop     {r3}
 100              	                msr     PSPLIM, r3
 101              	#endif
 102              	
 103              	#if CORTEX_USE_FPU
 104              	                /* Restoring FPU context.*/
 105              	                vpop    {s16-s31}
 106              	#endif
 107 000c BDE8F08F 	                pop     {r4, r5, r6, r7, r8, r9, r10, r11, pc}
 108              	
 109              	/*--------------------------------------------------------------------------*
 110              	 * Start a thread by invoking its work function.
 111              	 *
 112              	 * Threads execution starts here, the code leaves the system critical zone
 113              	 * and then jumps into the thread function passed in register R4. The
 114              	 * register R5 contains the thread parameter. The function chThdExit() is
 115              	 * called on thread function return.
 116              	 *--------------------------------------------------------------------------*/
 117              	                .thumb_func
ARM GAS  /tmp/cclqlCXs.s 			page 5


 118              	                .globl  __port_thread_start
 119              	__port_thread_start:
 120              	#if CH_DBG_SYSTEM_STATE_CHECK
 121              	                bl      __dbg_check_unlock
 122              	#endif
 123              	#if CH_DBG_STATISTICS
 124              	                bl      __stats_stop_measure_crit_thd
 125              	#endif
 126              	#if CORTEX_SIMPLIFIED_PRIORITY
 127              	                cpsie   i
 128              	#else
 129 0010 0023     	                movs    r3, #0              /* CORTEX_BASEPRI_DISABLED */
 130 0012 83F31188 	                msr     BASEPRI, r3
 131              	#endif
 132 0016 2846     	                mov     r0, r5
 133 0018 A047     	                blx     r4
 134 001a 0020     	                movs    r0, #0              /* MSG_OK */
 135 001c FFF7FEFF 	                bl      chThdExit
 136 0020 FEE7     	.zombies:       b       .zombies
 137              	
 138              	/*--------------------------------------------------------------------------*
 139              	 * Post-IRQ switch code.
 140              	 *
 141              	 * Exception handlers return here for context switching.
 142              	 *--------------------------------------------------------------------------*/
 143              	                .thumb_func
 144              	                .globl  __port_switch_from_isr
 145              	__port_switch_from_isr:
 146              	#if CH_DBG_STATISTICS
 147              	                bl      __stats_start_measure_crit_thd
 148              	#endif
 149              	#if CH_DBG_SYSTEM_STATE_CHECK
 150              	                bl      __dbg_check_lock
 151              	#endif
 152 0022 FFF7FEFF 	                bl      chSchDoPreemption
 153              	#if CH_DBG_SYSTEM_STATE_CHECK
 154              	                bl      __dbg_check_unlock
 155              	#endif
 156              	#if CH_DBG_STATISTICS
 157              	                bl      __stats_stop_measure_crit_thd
 158              	#endif
 159              	                .globl  __port_exit_from_isr
 160              	__port_exit_from_isr:
 161              	#if CORTEX_SIMPLIFIED_PRIORITY
 162              	                movw    r3, #:lower16:SCB_ICSR
 163              	                movt    r3, #:upper16:SCB_ICSR
 164              	                mov     r2, ICSR_PENDSVSET
 165              	                str     r2, [r3, #0]
 166              	                cpsie   i
 167              	#else /* !CORTEX_SIMPLIFIED_PRIORITY */
 168 0026 00DF     	                svc     #0
 169              	#endif /* !CORTEX_SIMPLIFIED_PRIORITY */
 170 0028 FEE7     	.L1:            b       .L1
ARM GAS  /tmp/cclqlCXs.s 			page 6


DEFINED SYMBOLS
.//os/common/ports/ARMv8-M-ML/compilers/GCC/chcoreasm.S:79     .text:0000000000000000 __port_switch
.//os/common/ports/ARMv8-M-ML/compilers/GCC/chcoreasm.S:80     .text:0000000000000000 $t
.//os/common/ports/ARMv8-M-ML/compilers/GCC/chcoreasm.S:119    .text:0000000000000010 __port_thread_start
.//os/common/ports/ARMv8-M-ML/compilers/GCC/chcoreasm.S:136    .text:0000000000000020 .zombies
.//os/common/ports/ARMv8-M-ML/compilers/GCC/chcoreasm.S:145    .text:0000000000000022 __port_switch_from_isr
.//os/common/ports/ARMv8-M-ML/compilers/GCC/chcoreasm.S:160    .text:0000000000000026 __port_exit_from_isr

UNDEFINED SYMBOLS
chThdExit
chSchDoPreemption
